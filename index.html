<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Calculadora de Derivadas Paso a Paso</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/12.4.1/math.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: sans-serif; max-width: 800px; margin: 20px auto; padding: 20px; background: #f2f2f2; }
    textarea, button { width: 100%; padding: 10px; margin-top: 10px; font-size: 16px; }
    button { background: #007bff; color: white; border: none; cursor: pointer; }
    pre { background: white; padding: 10px; margin-top: 10px; border: 1px solid #ccc; }
    canvas { margin-top: 30px; max-width: 100%; height: 400px; }
  </style>
</head>
<body>

  <h1>Calculadora de Derivadas con Proceso</h1>
  <label>Escribe una función en x:</label>
  <textarea id="entrada" placeholder="Ej: x^2 + sqrt(x) + 1/x"></textarea>
  <button onclick="derivar()">Calcular Derivada</button>

  <h2>Resultado Final</h2>
  <pre id="resultado"></pre>

  <h2>Procedimiento Paso a Paso (explicación simple)</h2>
  <pre id="pasos"></pre>

  <h2>Gráfica</h2>
  <canvas id="grafica"></canvas>

  <script>
    function derivar() {
      const entrada = document.getElementById("entrada").value;
      const scope = { x: 1 };
      let expr;

      try {
        expr = math.parse(entrada);
      } catch {
        document.getElementById("resultado").innerText = "❌ Error en la función.";
        return;
      }

      const derivada = math.derivative(expr, 'x');
      const simplificada = math.simplify(derivada);

      document.getElementById("resultado").innerText = simplificada.toString();

      // Procedimiento básico
      const pasos = `1. Función original: ${entrada}
2. Aplicamos reglas básicas de derivación.
3. Derivada sin simplificar: ${derivada.toString()}
4. Derivada simplificada: ${simplificada.toString()}`;

      document.getElementById("pasos").innerText = pasos;

      graficar(entrada, simplificada.toString());
    }

    function graficar(fx, dfx) {
      const labels = [], valoresF = [], valoresDf = [];

      const f = math.compile(fx);
      const df = math.compile(dfx);

      for (let x = -10; x <= 10; x += 0.5) {
        labels.push(x.toFixed(1));
        try {
          valoresF.push(f.evaluate({ x }));
        } catch {
          valoresF.push(null);
        }
        try {
          valoresDf.push(df.evaluate({ x }));
        } catch {
          valoresDf.push(null);
        }
      }

      const ctx = document.getElementById('grafica').getContext('2d');
      if (window.miGrafica) window.miGrafica.destroy();

      window.miGrafica = new Chart(ctx, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [
            { label: 'f(x)', data: valoresF, borderColor: 'blue', fill: false },
            { label: \"f'(x)\", data: valoresDf, borderColor: 'red', fill: false }
          ]
        },
        options: {
          responsive: true,
          scales: {
            x: { title: { display: true, text: 'x' } },
            y: { title: { display: true, text: 'y' } }
          }
        }
      });
    }
  </script>

</body>
</html>
